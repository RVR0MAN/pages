<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>СК ПОЕДИНОК - Администратор</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="common.js"></script>
    <script type="module" src="config.js"></script>
    <script type="module" src="admin.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Дополнительные стили для администратора */
        .list-container {
            max-height: 65vh;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .list-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            cursor: pointer;
        }

        .list-item h3 {
            margin: 0 0 5px 0;
        }

        .detail-view {
            padding: 15px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.2);
            margin-bottom: 15px;
        }

        .editable-field {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .editable-field input, .editable-field select {
            width: 100%;
            padding: 8px;
            border: none;
            background: transparent;
            color: rgb(255, 255, 255);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .payment-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }

        .paid {
            background: rgba(46, 204, 113, 0.3);
            border: 1px solid rgba(46, 204, 113, 0.5);
        }

        .unpaid {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid rgba(231, 76, 60, 0.5);
        }

        .group-tag {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            margin-right: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Главный экран -->
    <div id="mainScreen">
        <h1><i class="fas fa-handshake"></i>СК ПОЕДИНОК</h1>
        <div class="btn-container">
            <button id="profileBtn" class="btn"><i class="fas fa-user-cog"></i>Профиль</button>
            <button id="visitsBtn" class="btn"><i class="fas fa-calendar-check"></i>Посещения</button>
            <button id="manageAttendanceBtn" class="btn"><i class="fas fa-tasks"></i>Управление посещениями</button>
        </div>
    </div>

    <!-- Экран профиля -->
    <div id="profileScreen" class="hidden">
        <h2 class="screen-title">Профиль</h2>
        <div class="btn-container">
            <button id="applicationsBtn" class="btn"><i class="fas fa-file-alt"></i>Заявки</button>
            <button id="usersBtn" class="btn"><i class="fas fa-users"></i>Пользователи</button>
            <button id="groupsBtn" class="btn"><i class="fas fa-layer-group"></i>Группы</button>
            <button id="backFromProfileBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
        </div>
    </div>

    <!-- Экран заявок -->
    <div id="applicationsScreen" class="hidden">
        <h2 class="screen-title">Заявки</h2>
        <div class="card">
            <div id="applicationsList" class="list-container">
                <!-- Список заявок будет здесь -->
            </div>
            <div class="btn-container">
                <button id="backFromApplicationsBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран деталей заявки -->
    <div id="applicationDetailScreen" class="hidden">
        <h2 class="screen-title">Заявка</h2>
        <div class="card">
            <div id="applicationDetail" class="detail-view">
                <!-- Детали заявки будут здесь -->
            </div>
            <div class="btn-container">
                <button id="approveApplicationBtn" class="btn"><i class="fas fa-check"></i>Подтвердить</button>
                <button id="rejectApplicationBtn" class="btn"><i class="fas fa-times"></i>Отклонить</button>
                <button id="backFromApplicationDetailBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран пользователей -->
    <div id="usersScreen" class="hidden">
        <h2 class="screen-title">Пользователи</h2>
        <div class="btn-container">
            <button id="trainersBtn" class="btn"><i class="fas fa-chalkboard-teacher"></i>Тренерский состав</button>
            <button id="traineesBtn" class="btn"><i class="fas fa-user-graduate"></i>Ученики</button>
            <button id="backFromUsersBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
        </div>
    </div>

    <!-- Экран тренерского состава -->
    <div id="trainersScreen" class="hidden">
        <h2 class="screen-title">Тренерский состав</h2>
        <div class="card">
            <div id="trainersList" class="list-container">
                <!-- Список тренеров будет здесь -->
            </div>
            <div class="btn-container">
                <button id="backFromTrainersBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран деталей тренера -->
    <div id="trainerDetailScreen" class="hidden">
        <h2 class="screen-title">Тренер</h2>
        <div class="card">
            <div id="trainerDetail" class="detail-view">
                <!-- Детали тренера будут здесь -->
            </div>
            <div id="trainerEditForm" class="hidden">
                <!-- Форма редактирования тренера -->
            </div>
            <div class="btn-container">
                <button id="editTrainerBtn" class="btn"><i class="fas fa-edit"></i>Редактировать</button>
                <button id="saveTrainerBtn" class="btn hidden"><i class="fas fa-save"></i>Сохранить</button>
                <button id="cancelEditTrainerBtn" class="btn hidden"><i class="fas fa-times"></i>Отмена</button>
                <button id="backFromTrainerDetailBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран учеников -->
    <div id="traineesScreen" class="hidden">
        <h2 class="screen-title">Ученики</h2>
        <div class="card">
            <div id="traineesList" class="list-container">
                <!-- Список учеников будет здесь -->
            </div>
            <div class="btn-container">
                <button id="backFromTraineesBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран деталей ученика -->
    <div id="traineeDetailScreen" class="hidden">
        <h2 class="screen-title">Ученик</h2>
        <div class="card">
            <div id="traineeDetail" class="detail-view">
                <!-- Детали ученика будут здесь -->
            </div>
            <div id="traineeEditForm" class="hidden">
                <!-- Форма редактирования ученика -->
            </div>
            <div class="btn-container">
                <button id="editTraineeBtn" class="btn"><i class="fas fa-edit"></i>Редактировать</button>
                <button id="saveTraineeBtn" class="btn hidden"><i class="fas fa-save"></i>Сохранить</button>
                <button id="cancelEditTraineeBtn" class="btn hidden"><i class="fas fa-times"></i>Отмена</button>
                <button id="backFromTraineeDetailBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран групп -->
    <div id="groupsScreen" class="hidden">
        <h2 class="screen-title">Группы</h2>
        <div class="btn-container">
            <button id="createGroupBtn" class="btn"><i class="fas fa-plus-circle"></i>Создать группу</button>
            <button id="deleteGroupBtn" class="btn"><i class="fas fa-trash-alt"></i>Удалить группу</button>
            <button id="backFromGroupsBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
        </div>
    </div>

    <!-- Экран создания группы -->
    <div id="createGroupScreen" class="hidden">
        <h2 class="screen-title">Создать группу</h2>
        <div class="card">
            <div class="form-group">
                <label for="groupName">Номер группы</label>
                <div class="group-number-control">
                    <input type="number" id="groupName" class="group-number-input" min="1" value="1" required>
                    <div class="group-number-buttons">
                        <button id="groupNumberDecreaseBtn" type="button" class="btn icon-btn" aria-label="Уменьшить">−</button>
                        <button id="groupNumberIncreaseBtn" type="button" class="btn icon-btn" aria-label="Увеличить">+</button>
                    </div>
                </div>
            </div>
            <div class="btn-container">
                <button id="submitCreateGroupBtn" class="btn">Создать</button>
                <button id="backFromCreateGroupBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран удаления группы -->
    <div id="deleteGroupScreen" class="hidden">
        <h2 class="screen-title">Удалить группу</h2>
        <div class="card">
            <div class="form-group">
                <label for="deleteGroupSelect">Выберите группу для удаления</label>
                <select id="deleteGroupSelect" required>
                    <!-- Список групп будет загружен динамически -->
                </select>
            </div>
            <div class="btn-container">
                <button id="confirmDeleteGroupBtn" class="btn"><i class="fas fa-trash-alt"></i>Удалить</button>
            </div>
            <div class="btn-container">
                <button id="backFromDeleteGroupBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>
    <!-- Экран посещений -->
    <div id="visitsScreen" class="hidden">
        <h2 class="screen-title">Посещения</h2>
        <div class="card">
            <div class="date-picker-container">
                <div class="date-picker form-group">
                    <label for="startDate"><i class="fas fa-calendar-start"></i> Дата начала</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="date-picker form-group">
                    <label for="endDate"><i class="fas fa-calendar-end"></i> Дата окончания</label>
                    <input type="date" id="endDate" required>
                </div>
            </div>

            <div class="btn-container">
                <button id="selectGroupBtn" class="btn"><i class="fas fa-users"></i>Выбрать группу</button>
                <button id="selectTraineeBtn" class="btn"><i class="fas fa-user"></i>Выбрать ученика</button>
            </div>

            <div class="selection-fields">
                <div class="form-group">
                    <label for="selectedGroupDisplay">Выбранная группа</label>
                    <input type="text" id="selectedGroupDisplay" readonly placeholder="Не выбрана">
                </div>
                <div class="form-group">
                    <label for="selectedTraineeDisplay">Выбранный ученик</label>
                    <input type="text" id="selectedTraineeDisplay" readonly placeholder="Не выбран">
                </div>
            </div>

            <div class="btn-container">
                <button id="resetVisitsBtn" class="btn"><i class="fas fa-redo"></i>Сброс</button>
                <button id="viewVisitsBtn" class="btn"><i class="fas fa-eye"></i>Показать</button>
                <button id="backFromVisitsBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран результатов посещений с возможностью удаления -->
    <div id="visitsResultScreen" class="hidden">
        <h2 class="screen-title">Результаты посещений</h2>
        <div class="card">
            <div id="visitsResultList" class="list-container">
                <!-- Плитки посещений -->
            </div>
            <div class="btn-container">
                <button id="deleteSelectedVisitsBtn" class="btn">Удалить выбранные</button>
                <button id="backFromVisitsResultBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран выбора группы -->
    <div id="selectGroupScreen" class="hidden">
        <h2 class="screen-title">Выберите группу</h2>
        <div class="card">
            <div id="groupsListVisits" class="list-container">
                <!-- Список групп будет здесь -->
            </div>
            <div class="btn-container">
                <button id="backFromGroupSelectBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран выбора ученика -->
    <div id="selectTraineeScreen" class="hidden">
        <h2 class="screen-title">Выберите ученика</h2>
        <div class="card">
            <div id="traineesListVisits" class="list-container">
                <!-- Список учеников будет здесь -->
            </div>
            <div class="btn-container">
                <button id="backFromTraineeSelectBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран управления посещениями -->
    <div id="manageAttendanceScreen" class="hidden">
        <h2 class="screen-title">Управление посещениями</h2>
        <div class="card">
            <div class="btn-container">
                <button id="markPresentBtn" class="btn">Отметить присутствующих</button>
                <button id="addVisitationBtn" class="btn">Добавить посещение</button>
                
                <button id="backFromAttendanceBtn" class="btn"><i class="fas fa-arrow-left"></i>Назад</button>
            </div>
        </div>
    </div>

    <!-- В файле HTML -->
    <div id="markPresentScreen" class="hidden">
        <h2 class="screen-title">Отметить присутствующих</h2>
        <div class="card">
            <!-- Контейнер для плиток учеников -->
            <div id="traineesMarkList" class="list-container"></div>

            <div class="btn-container">
                <button id="confirmMarkPresentBtn" class="btn">Подтвердить</button>
                <button id="backFromMarkPresentBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>

    <!-- Экран: Добавить посещение -->
    <div id="addVisitationScreen" class="hidden">
        <h2 class="screen-title">Добавить посещение</h2>
        <div class="card">
            <div class="form-group">
                <label for="addVisitDate">Дата</label>
                <input type="date" id="addVisitDate" required>
            </div>
            <div class="form-group">
                <label for="addVisitTime">Время</label>
                <input type="time" id="addVisitTime" required>
            </div>

            <div class="selection-fields">
                <div class="form-group">
                    <label for="selectedTraineeForAddDisplay">Выбранный ученик</label>
                    <input type="text" id="selectedTraineeForAddDisplay" readonly placeholder="Не выбран">
                </div>
                <div class="form-group">
                    <label for="selectedGroupForAddDisplay">Выбранная группа</label>
                    <input type="text" id="selectedGroupForAddDisplay" readonly placeholder="Не выбрана">
                </div>
            </div>

            <div class="btn-container">
                <button id="selectTraineeForAddBtn" class="btn">Выбрать ученика</button>
                <button id="selectGroupForAddBtn" class="btn">Выбрать группу</button>
                <button id="resetAddVisitationBtn" class="btn"><i class="fas fa-redo"></i> Сбросить</button>
                <button id="confirmAddVisitationBtn" class="btn">Подтвердить</button>
                <button id="backFromAddVisitationBtn" class="btn">Назад</button>
            </div>
        </div>
    </div>

    
</div>

<!-- Глобальный экран загрузки -->
<div id="globalLoading" class="hidden">
    <div class="modal-content">
        <div class="spinner"></div>
        <p>Подождите...</p>
    </div>
    <style>
        #globalLoading {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
        }
        #globalLoading .modal-content {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px 28px;
            text-align: center;
            color: #fff;
            backdrop-filter: blur(8px);
        }
        #globalLoading .spinner {
            width: 36px;
            height: 36px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            margin: 0 auto 12px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</div>
<!-- Модальное окно ВНЕ контейнера -->
<div id="rejectModal" class="modal">
    <div class="modal-content">
        <h3>Укажите причину отклонения</h3>
        <textarea id="rejectReason" autofocus  placeholder="Введите причину..." rows="4"></textarea>
        <div class="modal-actions">
            <button id="submitReject" class="btn">Отклонить</button>
            <button id="closeRejectModal" class="btn btn-cancel">Закрыть</button>
        </div>
    </div>
</div>
</body>
</html>